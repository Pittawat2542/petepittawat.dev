<div 
  id="reading-progress-bar" 
  class="fixed top-0 left-0 h-1 bg-[color:var(--accent)] z-50 transition-[width] duration-150 ease-out will-change-[width]"
  style="width: 0%"
  role="progressbar"
  aria-label="Reading progress"
>
</div>

<script>
  const progressBar = document.getElementById('reading-progress-bar');
  
  // Only run on client
  if (progressBar && typeof window !== 'undefined') {
    let ticking = false;
    let docHeight = 0;

    const computeDocHeight = () => {
      // READ: only on resize/initialization
      const body = document.body;
      const html = document.documentElement;
      const full = Math.max(
        body.scrollHeight,
        html.scrollHeight,
        body.offsetHeight,
        html.offsetHeight,
        body.clientHeight,
        html.clientHeight
      );
      docHeight = Math.max(0, full - window.innerHeight);
    };

    const writeProgress = () => {
      // READ: scroll position
      const y = window.scrollY || document.documentElement.scrollTop || 0;
      const pct = docHeight > 0 ? Math.min((y / docHeight) * 100, 100) : 0;
      // WRITE: width
      progressBar.style.width = `${pct}%`;
      ticking = false;
    };

    const onScroll = () => {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(writeProgress);
    };

    const onResize = () => {
      computeDocHeight();
      onScroll();
    };

    // Initial measure + paint
    computeDocHeight();
    requestAnimationFrame(writeProgress);

    // Listeners (throttled via rAF)
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onResize, { passive: true });
    window.addEventListener('orientationchange', onResize, { passive: true });
  }
</script>

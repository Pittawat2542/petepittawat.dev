---
import { cn } from '@/lib/utils';
import '@/styles/components/search-trigger.css';

export interface Props {
  variant: 'desktop' | 'mobile' | 'drawer';
  class?: string;
}

const VARIANT_CONFIG = {
  desktop: {
    id: 'open-search-desktop',
    baseClass:
      'search-trigger search-trigger--primary hidden md:inline-flex items-center gap-2 shape-squircle-sm rounded-[1.25rem] px-3.5 py-2 text-sm text-[color:var(--white)]/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--white)]/28',
    iconSize: 16,
    showText: true,
    showShortcut: true,
  },
  mobile: {
    id: 'open-search-mobile',
    baseClass:
      'search-trigger search-trigger--icon md:hidden inline-flex items-center justify-center shape-squircle-sm rounded-[1.2rem] p-2.5 text-[color:var(--white)]/85 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--white)]/28',
    iconSize: 18,
    showText: false,
    showShortcut: false,
  },
  drawer: {
    id: 'open-search-drawer',
    baseClass:
      'search-trigger search-trigger--drawer glass-button flex w-full items-center gap-3 shape-squircle-sm rounded-[1.25rem] border border-[color:var(--white)]/15 bg-[color:var(--white)]/[0.06] px-4 py-3 text-base font-medium text-[color:var(--white)]/90 hover:border-[color:var(--white)]/25 hover:bg-[color:var(--white)]/[0.12] hover:text-[color:var(--white)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--white)]/30',
    iconSize: 20,
    showText: true,
    showShortcut: false,
  },
} as const;

const { variant, class: className } = Astro.props;
const config = VARIANT_CONFIG[variant] ?? VARIANT_CONFIG.desktop;
const buttonClass = cn(config.baseClass, className);
const title = variant === 'desktop' ? 'Search (âŒ˜/Ctrl + K)' : 'Search';

const renderSearchIcon = (size: number) => (
  <svg
    width={size}
    height={size}
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    aria-hidden="true"
  >
    <circle cx="11" cy="11" r="8" />
    <path d="m21 21-4.3-4.3" />
  </svg>
);
---

<button id={config.id} class={buttonClass} aria-label="Open search" title={title} type="button">
  {renderSearchIcon(config.iconSize)}
  {config.showText && <span class="opacity-90">Search</span>}
  {
    config.showShortcut && (
      <span class="search-trigger__shortcut ml-2 items-center gap-1 rounded-md border border-white/10 px-1.5 py-0.5 text-xs text-white/70">
        <svg
          width="12"
          height="12"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M18 8a6 6 0 0 1-6 6" />
          <path d="M5 19v-7a2 2 0 0 1 2-2h7" />
        </svg>
        K
      </span>
    )
  }
</button>

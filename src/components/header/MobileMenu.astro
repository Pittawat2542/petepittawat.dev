---
import SearchButton from './SearchButton.astro';
import { BookOpenText, FolderKanban, FileText, Mic2, User2, ChevronRight } from 'lucide-astro';

export interface Props {
  currentPath: string;
  class?: string;
}

const { currentPath } = Astro.props;

const links = [
  { href: '/blog', label: 'Blog' },
  { href: '/projects', label: 'Projects' },
  { href: '/publications', label: 'Publications' },
  { href: '/talks', label: 'Talks' },
  { href: '/about', label: 'About' },
];

const isActive = (href: string) =>
  currentPath === href || (href !== '/' && currentPath.startsWith(href + '/'));
---

<!-- Mobile menu toggle -->
<button
  id="menu-toggle"
  type="button"
  data-open="false"
  class="menu-toggle md:hidden"
  aria-label="Open menu"
  aria-controls="mobile-menu"
  aria-expanded="false"
>
  <span class="menu-toggle__icon" aria-hidden="true">
    <span></span>
    <span></span>
    <span></span>
  </span>
</button>

<!-- Backdrop for mobile menu -->
<div
  id="mobile-menu-overlay"
  class="pointer-events-none fixed inset-0 z-30 bg-[color:var(--black-nav,#020617)]/70 opacity-0 backdrop-blur-sm transition-opacity duration-300 ease-out supports-[backdrop-filter]:bg-[color:var(--black-nav,#020617)]/55 md:hidden"
>
</div>

<!-- Mobile menu panel: full-screen overlay with centered glass sheet -->
<div
  id="mobile-menu"
  class="pointer-events-none fixed inset-0 z-40 flex items-start justify-center px-4 opacity-0 transition-opacity duration-300 ease-out md:hidden"
>
  <div
    id="mobile-menu-sheet"
    class="mx-auto mt-[max(env(safe-area-inset-top),1rem)] w-[min(96vw,38rem)] -translate-y-4 scale-[0.97] opacity-0 transition-[transform,opacity] duration-300 ease-out"
  >
    <div
      class="glass-card no-hover-lift no-paint-contain overflow-hidden rounded-3xl border border-[color:var(--white)]/12 bg-[color:var(--black-nav)]/75 shadow-2xl shadow-black/25 backdrop-blur-xl supports-[backdrop-filter]:bg-[color:var(--black-nav)]/55"
    >
      <!-- Quick action: Search -->
      <div class="p-2.5">
        <SearchButton variant="drawer" />
      </div>
      <ul class="grid grid-cols-1 gap-3 px-2.5 pb-4">
        {
          links.map(({ href, label }) => (
            <li>
              <a
                href={href}
                class={`group group/mobile-nav relative isolate w-full touch-manipulation overflow-hidden rounded-2xl border border-[color:var(--white)]/12 bg-[color:var(--white)]/[0.05] px-5 py-4 text-base font-medium text-[color:var(--white)]/88 transition-[transform,background-color,border-color,color,box-shadow] duration-250 ease-out hover:border-[color:var(--white)]/24 hover:bg-[color:var(--white)]/[0.12] hover:text-[color:var(--white)] focus-visible:ring-2 focus-visible:ring-[color:var(--accent,#6bc1ff)]/45 focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--black-nav,#020617)] focus-visible:outline-none active:scale-[0.99] motion-reduce:transition-none motion-reduce:active:scale-100 ${isActive(href) ? 'pointer-events-none cursor-default border-[color:var(--accent,#6bc1ff)]/40 bg-[color:var(--accent,#6bc1ff)]/[0.2] text-[color:var(--white)] shadow-[0_24px_48px_-32px_rgba(6,14,30,0.92)]' : ''}`}
                data-active={isActive(href) ? 'true' : undefined}
                aria-current={isActive(href) ? 'page' : undefined}
                tabindex={isActive(href) ? -1 : undefined}
              >
                <span class="pointer-events-none absolute inset-0 bg-[linear-gradient(135deg,rgba(106,193,255,0.18),rgba(255,255,255,0.06))] opacity-0 transition-opacity duration-300 ease-out group-hover/mobile-nav:opacity-100 group-focus-visible/mobile-nav:opacity-100 group-data-[active=true]/mobile-nav:opacity-100" />
                <span class="relative flex items-center gap-3">
                  <span
                    class={`inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-[color:var(--white)]/12 bg-[color:var(--white)]/[0.06] text-[color:var(--white)]/80 transition-all duration-300 ease-out group-hover/mobile-nav:border-[color:var(--white)]/26 group-hover/mobile-nav:bg-[color:var(--white)]/[0.14] group-hover/mobile-nav:text-[color:var(--white)] ${isActive(href) ? 'border-[color:var(--accent,#6bc1ff)]/50 bg-[color:var(--accent,#6bc1ff)]/20 text-[color:var(--accent,#6bc1ff)] shadow-[0_0_18px_rgba(106,193,255,0.35)]' : ''}`}
                    aria-hidden="true"
                  >
                    {label === 'Blog' && <BookOpenText class="h-5 w-5" aria-hidden="true" />}
                    {label === 'Projects' && <FolderKanban class="h-5 w-5" aria-hidden="true" />}
                    {label === 'Publications' && <FileText class="h-5 w-5" aria-hidden="true" />}
                    {label === 'Talks' && <Mic2 class="h-5 w-5" aria-hidden="true" />}
                    {label === 'About' && <User2 class="h-5 w-5" aria-hidden="true" />}
                  </span>
                  <span class="relative min-w-0 flex-1 text-left">
                    <span class="block truncate text-base leading-tight font-semibold tracking-[0.01em]">
                      {label}
                    </span>
                    {isActive(href) && (
                      <span class="mt-1 inline-flex items-center gap-1 text-sm font-medium text-[color:var(--accent,#6bc1ff)]/85">
                        <span class="h-1.5 w-1.5 rounded-full bg-[color:var(--accent,#6bc1ff)]" />
                        Currently viewing
                      </span>
                    )}
                  </span>
                  <ChevronRight
                    class={`h-5 w-5 shrink-0 text-[color:var(--white)]/60 transition-transform duration-250 ease-out group-hover/mobile-nav:translate-x-1 group-focus-visible/mobile-nav:translate-x-1 ${isActive(href) ? 'text-[color:var(--accent,#6bc1ff)]/85' : ''}`}
                    aria-hidden="true"
                  />
                </span>
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</div>

<style>
  .menu-toggle {
    position: relative;
  }

  .menu-toggle__icon {
    position: relative;
    display: inline-flex;
    flex-direction: column;
    justify-content: space-between;
    width: 1.5rem;
    height: 1.125rem;
  }

  .menu-toggle__icon span {
    display: block;
    width: 100%;
    height: 2px;
    border-radius: 999px;
    background: currentColor;
    transition:
      transform 0.35s cubic-bezier(0.22, 0.61, 0.36, 1),
      opacity 0.3s ease,
      width 0.3s ease;
  }

  .menu-toggle[data-open='true'] .menu-toggle__icon span:nth-child(1) {
    transform: translateY(0.425rem) rotate(45deg);
  }

  .menu-toggle[data-open='true'] .menu-toggle__icon span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0.4);
  }

  .menu-toggle[data-open='true'] .menu-toggle__icon span:nth-child(3) {
    transform: translateY(-0.425rem) rotate(-45deg);
  }

  @media (prefers-reduced-motion: reduce) {
    .menu-toggle__icon span,
    .menu-toggle[data-open='true'] .menu-toggle__icon span {
      transition-duration: 0s;
      transform: none !important;
      opacity: 1 !important;
    }
  }
</style>

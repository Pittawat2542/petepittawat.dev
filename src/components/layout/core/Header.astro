---
import SiteLogo from '@/components/header/SiteLogo.astro';
import Navigation from '@/components/header/Navigation.tsx';
import SearchButton from '@/components/header/SearchButton.astro';
import MobileMenu from '@/components/header/MobileMenu.astro';
import '@/styles/components/site-header.css';

// Normalize current path to work with both `build.format: "file"` (e.g. "/talks.html")
// and directory-style paths (e.g. "/talks/"). This ensures active nav detection works.
let current =
  Astro.url.pathname
    // Map "/index.html" to root
    .replace(/\/index\.html$/, '/')
    // Strip any .html extension (e.g., "/talks.html" -> "/talks")
    .replace(/\.html$/, '')
    // Remove any trailing slashes
    .replace(/\/+$/, '') || '/';
---

<header
  class="site-header"
  style="top: max(env(safe-area-inset-top), 1rem); view-transition-name: site-header;"
>
  <div class="site-header__container" id="site-nav-shell" data-scrolled="false">
    <div class="site-header__glow" aria-hidden="true"></div>
    <div class="site-header__sheen" aria-hidden="true"></div>
    <nav id="site-nav" aria-label="Primary" data-scrolled="false" class="site-header__nav">
      <div class="site-header__brand">
        <SiteLogo />
      </div>

      <Navigation currentPath={current} />

      <div class="site-header__actions">
        <SearchButton variant="desktop" />
        <div class="site-header__divider" aria-hidden="true"></div>
        <SearchButton variant="mobile" />
        <MobileMenu currentPath={current} />
      </div>
    </nav>
  </div>
</header>

<script>
  import '@/scripts/components/header.ts';
</script>

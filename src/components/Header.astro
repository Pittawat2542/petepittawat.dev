---
import HeaderLink from './HeaderLink.astro';
import logoImage from '../assets/images/logo.png';
import { SITE_TITLE } from '../consts';
import { Image } from 'astro:assets';
import { BookText, Mic, ScrollText, User, FolderKanban } from 'lucide-astro';
import ThemeToggle from './ThemeToggle.astro';

const current = Astro.url.pathname.replace(/\/+$/, '') || '/';
const links = [
  { href: '/blog', label: 'Blog', Icon: BookText },
  { href: '/projects', label: 'Projects', Icon: FolderKanban },
  { href: '/publications', label: 'Publications', Icon: ScrollText },
  { href: '/talks', label: 'Talks', Icon: Mic },
  { href: '/about', label: 'About', Icon: User },
];

const isActive = (href: string) =>
  current === href || (href !== '/' && current.startsWith(href + '/'));
---

<header class="fixed inset-x-0 z-50" style="top: max(env(safe-area-inset-top), 1rem)">
  <div class="mx-auto w-fit max-w-[min(92vw,72rem)]">
    <div class="relative inline-flex rounded-full p-[1px]
                bg-gradient-to-r from-[color:var(--white)]/15 via-transparent to-[color:var(--white)]/15">
      <nav id="site-nav" aria-label="Primary"
           class="inline-flex items-center gap-1 rounded-[inherit] border border-[color:var(--white)]/10
                  bg-[color:var(--black-nav)]/70 supports-[backdrop-filter]:bg-[color:var(--black-nav)]/55
                  backdrop-blur-md shadow-lg shadow-black/10 px-2 py-2 pr-3 glass-nav
                  transition-[background,box-shadow,transform] duration-300 ease-out
                  data-[scrolled=true]:shadow-black/20 data-[scrolled=true]:backdrop-blur-lg
                  overflow-x-auto overscroll-x-contain scrollbar-none
                  snap-x snap-proximity md:snap-none
                  [mask-image:linear-gradient(to_right,transparent_0,black_12px,black_calc(100%-12px),transparent_100%)]">
        <a href="/" aria-label="Go to homepage"
           class="group text-[color:var(--white)] flex min-w-0 gap-2 items-center rounded-full px-3 py-2
                  hover:bg-[color:var(--white)]/5 transition-colors focus-visible:outline-none
                  focus-visible:ring-2 focus-visible:ring-[color:var(--white)]/30 snap-start">
          <Image class="h-6 w-6 shrink-0 transition-transform motion-safe:group-hover:scale-105"
                 src={logoImage} alt="Main logo of PETEPITTAWAT.DEV" />
          <span class="hidden md:inline whitespace-nowrap md:ml-1 font-medium max-w-[40vw] truncate">
            {SITE_TITLE}
          </span>
        </a>

        <ul class="ml-3 sm:ml-4 md:ml-6 flex items-center gap-1">
          {links.map(({ href, label, Icon }) => (
            <li>
              <HeaderLink href={href} isActive={isActive(href)} ariaLabel={label} class="snap-start">
                <Icon class="inline-block md:hidden h-[1.15rem] w-[1.15rem]" aria-hidden="true" />
                <span class="hidden md:inline">{label}</span>
              </HeaderLink>
            </li>
          ))}
        </ul>

        <div class="ml-3 pl-3 mr-2 shrink-0 sm:border-s border-[color:var(--white)]/10 snap-start">
          <ThemeToggle
            class="rounded-xl p-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--white)]/30"
            aria-label="Toggle theme"
          />
        </div>
      </nav>
    </div>
  </div>
</header>

<script is:inline>
  const nav = document.getElementById('site-nav');
  const onScroll = () => {
    if (!nav) return;
    nav.dataset.scrolled = window.scrollY > 6 ? 'true' : 'false';
  };
  onScroll();
  window.addEventListener('scroll', onScroll, { passive: true });
</script>
